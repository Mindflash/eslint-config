version: 0.2

env:
  variables:
    NODE_ENV: 'development'
  parameter-store:
    NPM_TOKEN: /secrets/ops/us-east-1/build-pipelines/shared/npm_token

phases:
  install:
    runtime-versions:
      nodejs: latest
    commands:
      - echo "Installing dependencies..."
      - echo "Creating .npmrc for authenticated access..."
      - echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" > .npmrc
      - npm i

  pre_build:
    commands:
      - echo "Running pre-build checks..."
      - node --version
      - npm --version

  build:
    commands:
      - echo "Running linting..."
      - npm run lint
      - echo "Running format check..."
      - npm run format:check
      - echo "Validating configuration..."
      - node -c eslint.config.js
      - echo "Testing configuration against sample files..."
      - echo 'console.log("test");' > test-file.js
      - npx eslint test-file.js
      - rm test-file.js

  post_build:
    commands:
      - echo "Build completed successfully"

reports:
  eslint:
    files:
      - 'eslint-report.json'
    base-directory: '.'
